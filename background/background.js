function notify(t,e){ex.notify({title:"Ddict",data:t,icon:"/icon/icon.png"},e||function(){})}function translate(t,e){ddict.translate(t,function(t){return t?(t.audio&&ddict.loggedin&&(ddict.saveWord(t),ex.emit("save")),e(t)):(ex.emit("error","error translate"),e({error:"Oops there is a problem with the internet. Try again later :("}))})}function translateContent(t,e){translate(t,function(t){t.img=chrome.extension.getURL("img/audio.png"),e({audio:t.audio,html:ddict.renderContent(t),rtl:checkRtl(ex.get("to"))})})}function translateContext(t,e){return t?(t=t.trim(),t.length?(ex.emit("context"),void translate(t,function(t){t.audio&&ex.get("auto_audio")&&playAudio(t.audio);var n=t.sentence.join("\n");return e({text:n,rtl:checkRtl(ex.get("to"))})})):e({text:"Please highlight some text."})):e({text:"Please highlight some text."})}function translatePopup(t,e){translate(t,function(n){var i=ddict.renderPopup(n);n.error||ex.set({from_text:t,to_text:i}),e(i)})}function checkRtl(t){return["ar","fa","iw","yi","ur","pa"].indexOf(t)>-1}function playAudio(t){t&&(ex.emit("audio"),ex.playAudio(t))}var build=require("build"),Ddict=build.ddict,ex=build.extension;GA("UA-24951846-5",ex),TKK=null,ex.on("install",function(){ex.tab.create("http://ddict.me/thank-you"),notify("Click here to login to Ddict to save history and build your own phrasebook."),ex.set({dblclick:1,shift:1,auto_audio:1,btn:1})}),ex.on("update",function(){ex.tab.create("http://ddict.me/whats-new")}),ex.on("message",function(t,e,n){var i=t.channel,o=t.data;switch(i){case"translate":if(!t.src)return;return ex.emit(t.src),"popup"===t.src?translatePopup(o,n):translateContent(o,n);case"get":n(ex.get());break;case"set":o.from&&(ddict.from=o.from),o.to&&(ddict.to=o.to),ex.set(o),n();break;case"audio":playAudio(o),n();break;case"loggedin":ddict.loggedin=o,ex.set({loggedin:ddict.loggedin}),n()}}),ex.on("notification",function(){ex.tab.create("http://dashboard.ddict.me/phrasebook/")});var ddict=Ddict({from:ex.get("from"),to:ex.get("to"),notify:notify});ddict.checkLogin(function(t,e){t||e!=!!ex.get("loggedin")&&(e||notify("You are not logged in to Ddict yet. Click here to login again."),ddict.loggedin=e,ex.set({loggedin:e}))}),ex.set({from:ddict.from,to:ddict.to}),ex.context_menu.create({title:"Translate",onClick:function(t,e){if(t&&e&&!(e.id<0)){var n=t&&t.selectionText;translateContext(n,function(t){ex.send(e.id,t)})}}});